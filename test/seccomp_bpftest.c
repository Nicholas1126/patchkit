#include <stdio.h> 
#include <unistd.h>  
#include <linux/seccomp.h>
#include <seccomp.h>
#include<fcntl.h>
#include <sys/prctl.h>
#include <linux/filter.h>
/*
00000000  20 00 00 00 04 00 00 00  15 00 00 0a 3e 00 00 c0  | ...........>...|
00000010  20 00 00 00 00 00 00 00  35 00 00 01 00 00 00 40  | .......5......@|
00000020  15 00 00 07 ff ff ff ff  15 00 06 00 29 00 00 00  |............)...|

00000030  15 00 05 00 2a 00 00 00  15 00 04 00 31 00 00 00  |....*.......1...|
00000040  15 00 03 00 32 00 00 00  15 00 02 00 38 00 00 00  |....2.......8...|
00000050  15 00 01 00 3b 00 00 00  06 00 00 00 00 00 ff 7f  |....;...........|
00000060  06 00 00 00 00 00 00 00                           |........|
00000068
*/
//gcc -g seccomp_bpftest.c -o seccomp_bpftest -lseccomp
struct sock_filter sfi[] = {
		{0x20,0x00,0x00,0x00000004},
		{0x15,0x00,0x0a,0xc000003e},
		{0x20,0x00,0x00,0x00000000},
		{0x35,0x00,0x01,0x40000000},
		{0x15,0x00,0x07,0xffffffff},
		{0x15,0x06,0x00,0x00000029},
		{0x15,0x05,0x00,0x0000002a},
		{0x15,0x04,0x00,0x00000031},
		{0x15,0x03,0x00,0x00000032},
		{0x15,0x02,0x00,0x00000038},
		{0x15,0x01,0x00,0x0000003b},
		{0x06,0x00,0x00,0x7fff0000},
        {0x06,0x00,0x00,0x00000000}
};
/*
struct sock_filter sfi[] = {
		{0x20,0x00,0x00,0x00000004},
		{0x15,0x00,0x09,0xc000003e},
		{0x20,0x00,0x00,0x00000000},
		{0x35,0x07,0x00,0x40000000},
		{0x15,0x06,0x00,0x00000029},
		{0x15,0x05,0x00,0x0000002a},
		{0x15,0x04,0x00,0x00000031},
		{0x15,0x03,0x00,0x00000032},
		{0x15,0x02,0x00,0x00000038},
		{0x15,0x01,0x00,0x0000003b},
		{0x06,0x00,0x00,0x7fff0000},
		{0x06,0x00,0x00,0x00000000}
};
*/

struct sock_fprog sfp = {12,sfi};
int main() {
  prctl(PR_SET_NO_NEW_PRIVS,1,0,0,0);
  prctl(PR_SET_SECCOMP,SECCOMP_MODE_FILTER,&sfp);
  system("/bin/sh");
  return 0; 
}